# 好友系统功能说明

## 📋 功能概述

好友系统是一个完整的社交功能模块，允许用户通过UID搜索、添加、管理好友关系。

## 🎯 主要功能

### 1. 好友列表管理

- **查看好友列表**：显示所有已接受的好友
- **好友信息显示**：头像、昵称、UID、角色、在线状态
- **删除好友**：支持删除好友关系（双向删除）

### 2. 好友请求系统

- **发送好友请求**：通过UID搜索用户并发送好友请求
- **接受好友请求**：接受其他用户的好友请求
- **拒绝好友请求**：拒绝不需要的好友请求
- **请求状态管理**：自动处理双向好友关系

### 3. 用户搜索功能

- **UID搜索**：通过8位数字UID搜索用户
- **用户信息展示**：显示搜索结果用户的基本信息
- **一键添加**：直接从搜索结果发送好友请求

### 4. 在线状态显示

- **实时状态**：显示好友的在线/离线状态
- **最后在线时间**：显示好友最后登录时间
- **状态更新**：基于最后登录时间自动更新状态

## 🛠️ 技术实现

### 后端API

#### 路由结构

```
/api/friends/
├── GET /                    # 获取好友列表
├── GET /requests            # 获取好友请求
├── POST /request            # 发送好友请求
├── POST /accept             # 接受好友请求
├── POST /reject             # 拒绝好友请求
├── DELETE /:friendId        # 删除好友
└── GET /stats               # 获取好友统计
```

#### 数据库表结构

```sql
CREATE TABLE `user_friends` (
  `id` int(11) NOT NULL COMMENT '记录ID',
  `user_id` varchar(50) NOT NULL COMMENT '用户ID',
  `friend_id` varchar(50) NOT NULL COMMENT '好友ID',
  `status` enum('pending','accepted','blocked') NOT NULL DEFAULT 'pending' COMMENT '关系状态',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='用户好友关系表';
```

### 前端组件

#### 主要功能模块

- **UserFriends.vue**：好友系统主组件
- **搜索界面**：UID搜索和用户信息展示
- **好友列表**：好友卡片展示和管理
- **请求管理**：好友请求的接受/拒绝操作

#### 状态管理

- **响应式数据**：使用Vue 3 Composition API
- **实时更新**：操作后自动刷新数据
- **错误处理**：完善的错误提示和用户反馈

## 🔧 核心功能详解

### 1. 好友请求流程

```
用户A搜索用户B → 发送好友请求 → 用户B收到请求 → 用户B接受/拒绝 → 建立/取消好友关系
```

### 2. 双向关系管理

- **发送请求**：A向B发送请求，状态为pending
- **接受请求**：B接受请求，同时创建B→A的accepted关系
- **删除好友**：删除A→B和B→A的双向关系

### 3. 在线状态判断

- **在线**：最后登录时间在5分钟内
- **离线**：最后登录时间超过5分钟
- **显示格式**：在线/最后在线时间

## 📱 用户界面

### 标签页结构

1. **好友列表**：显示所有好友
2. **好友请求**：显示待处理的好友请求
3. **添加好友**：搜索和添加新好友

### 统计信息

- **总好友数**：已接受的好友总数
- **在线好友**：当前在线的好友数量
- **待处理请求**：收到但未处理的好友请求数

### 交互设计

- **卡片式布局**：清晰的好友信息展示
- **操作按钮**：直观的接受/拒绝/删除操作
- **状态指示**：在线状态和角色标识
- **响应式设计**：适配不同屏幕尺寸

## 🔒 安全特性

### 权限控制

- **身份验证**：所有API都需要JWT token
- **用户验证**：确保只能操作自己的好友关系
- **数据隔离**：用户只能看到自己的好友和请求

### 数据验证

- **UID格式验证**：确保UID为纯数字
- **关系检查**：防止重复添加和自添加
- **状态管理**：确保好友关系的正确性

## 🚀 扩展功能

### 已实现

- ✅ 基础好友管理
- ✅ UID搜索添加
- ✅ 请求处理系统
- ✅ 在线状态显示
- ✅ 统计信息展示

### 可扩展功能

- 🔄 好友分组管理
- 🔄 好友备注功能
- 🔄 好友动态展示
- 🔄 批量操作功能
- 🔄 好友推荐系统

## 📊 性能优化

### 数据库优化

- **索引设计**：user_id和friend_id的复合索引
- **查询优化**：使用JOIN减少查询次数
- **状态缓存**：在线状态的计算优化

### 前端优化

- **懒加载**：按需加载好友数据
- **缓存策略**：合理的数据缓存机制
- **错误处理**：优雅的错误处理和用户提示

## 🎨 用户体验

### 视觉设计

- **赛博朋克风格**：与整体UI风格保持一致
- **状态指示**：清晰的在线/离线状态显示
- **交互反馈**：操作成功/失败的即时反馈

### 操作流程

- **简化流程**：最少步骤完成好友添加
- **智能提示**：操作前的确认和结果反馈
- **错误恢复**：友好的错误提示和恢复建议

## 📝 使用说明

### 添加好友

1. 切换到"添加好友"标签
2. 输入目标用户的UID（8位数字）
3. 点击搜索按钮
4. 确认用户信息后点击"添加好友"
5. 等待对方接受请求

### 管理好友

1. 在"好友列表"中查看所有好友
2. 点击聊天按钮开始对话（功能开发中）
3. 点击删除按钮移除好友关系

### 处理请求

1. 在"好友请求"中查看收到的请求
2. 点击接受按钮添加为好友
3. 点击拒绝按钮拒绝请求

## 🔮 未来规划

### 短期目标

- 完善错误处理和用户反馈
- 优化移动端体验
- 添加好友通知功能

### 长期目标

- 集成聊天系统
- 好友动态和活动展示
- 社交推荐算法
- 好友分组和标签系统

---

*好友系统为用户提供了完整的社交功能基础，支持用户之间的连接和互动，为后续的社交功能扩展奠定了坚实的基础。*

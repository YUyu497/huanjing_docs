# FiveM服务器官网 - 详细开发流程文档

## 项目概述

- **项目名称**: FiveM服务器官网
- **技术栈**: Vue3 + Node.js + MySQL
- **开发周期**: 2周
- **目标**: 快速搭建基础官网

## 开发环境准备

### 1. 开发工具安装

```bash
# 安装Node.js 18.x
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# 安装MySQL
sudo apt-get install mysql-server

# 安装Git
sudo apt-get install git

# 安装VSCode (推荐)
# 下载地址: https://code.visualstudio.com/
```

### 2. 项目目录结构

```
fivem-website/
├── frontend/          # Vue3前端项目
├── backend/           # Node.js后端项目
├── database/          # 数据库脚本
├── docs/             # 项目文档
└── README.md
```

## 第1周开发流程

### Day 1: 项目初始化

#### 1.1 创建项目目录

```bash
mkdir fivem-website
cd fivem-website
mkdir frontend backend database docs
```

#### 1.2 初始化前端项目

```bash
cd frontend
npm create vue@latest . --yes
npm install
npm install element-plus axios pinia
```

#### 1.3 初始化后端项目

```bash
cd ../backend
npm init -y
npm install express mysql2 jsonwebtoken bcryptjs cors dotenv
npm install -D nodemon
```

#### 1.4 配置package.json脚本

```json
{
  "scripts": {
    "dev": "nodemon app.js",
    "start": "node app.js"
  }
}
```

### Day 2: 数据库设计

#### 2.1 创建数据库

```sql
CREATE DATABASE fivem_website;
USE fivem_website;
```

#### 2.2 创建用户表

```sql
CREATE TABLE users (
    id INT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    role ENUM('user', 'admin') DEFAULT 'user',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### 2.3 创建内容表

```sql
CREATE TABLE contents (
    id INT PRIMARY KEY AUTO_INCREMENT,
    title VARCHAR(200) NOT NULL,
    content TEXT NOT NULL,
    type ENUM('announcement', 'guide') NOT NULL,
    author_id INT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (author_id) REFERENCES users(id)
);
```

### Day 3: 后端API开发

#### 3.1 创建基础Express应用

```javascript
// backend/app.js
const express = require('express');
const cors = require('cors');
const dotenv = require('dotenv');

dotenv.config();
const app = express();

app.use(cors());
app.use(express.json());

const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
    console.log(`Server running on port ${PORT}`);
});
```

#### 3.2 数据库连接配置

```javascript
// backend/config/database.js
const mysql = require('mysql2');

const db = mysql.createConnection({
    host: process.env.DB_HOST || 'localhost',
    user: process.env.DB_USER || 'root',
    password: process.env.DB_PASSWORD || '',
    database: process.env.DB_NAME || 'fivem_website'
});

module.exports = db;
```

#### 3.3 用户认证API

```javascript
// backend/routes/auth.js
const express = require('express');
const bcrypt = require('bcryptjs');
const jwt = require('jsonwebtoken');
const db = require('../config/database');

const router = express.Router();

// 用户注册
router.post('/register', async (req, res) => {
    const { username, email, password } = req.body;
    
    try {
        const hashedPassword = await bcrypt.hash(password, 10);
        const result = await db.promise().execute(
            'INSERT INTO users (username, email, password) VALUES (?, ?, ?)',
            [username, email, hashedPassword]
        );
        res.json({ success: true, message: '注册成功' });
    } catch (error) {
        res.status(400).json({ success: false, message: '注册失败' });
    }
});

// 用户登录
router.post('/login', async (req, res) => {
    const { email, password } = req.body;
    
    try {
        const [rows] = await db.promise().execute(
            'SELECT * FROM users WHERE email = ?',
            [email]
        );
        
        if (rows.length === 0) {
            return res.status(400).json({ success: false, message: '用户不存在' });
        }
        
        const user = rows[0];
        const isValidPassword = await bcrypt.compare(password, user.password);
        
        if (!isValidPassword) {
            return res.status(400).json({ success: false, message: '密码错误' });
        }
        
        const token = jwt.sign({ userId: user.id, role: user.role }, process.env.JWT_SECRET);
        res.json({ success: true, token, user: { id: user.id, username: user.username, role: user.role } });
    } catch (error) {
        res.status(500).json({ success: false, message: '登录失败' });
    }
});

module.exports = router;
```

### Day 4: 前端基础框架

#### 4.1 配置Vue Router

```javascript
// frontend/src/router/index.js
import { createRouter, createWebHistory } from 'vue-router'
import Home from '../views/Home.vue'
import Login from '../views/Login.vue'
import Register from '../views/Register.vue'
import Admin from '../views/Admin.vue'

const routes = [
  { path: '/', name: 'Home', component: Home },
  { path: '/login', name: 'Login', component: Login },
  { path: '/register', name: 'Register', component: Register },
  { path: '/admin', name: 'Admin', component: Admin, meta: { requiresAuth: true, requiresAdmin: true } }
]

const router = createRouter({
  history: createWebHistory(),
  routes
})

export default router
```

#### 4.2 配置Pinia状态管理

```javascript
// frontend/src/stores/auth.js
import { defineStore } from 'pinia'
import axios from 'axios'

export const useAuthStore = defineStore('auth', {
  state: () => ({
    user: null,
    token: localStorage.getItem('token')
  }),
  
  actions: {
    async login(credentials) {
      try {
        const response = await axios.post('/api/auth/login', credentials)
        this.token = response.data.token
        this.user = response.data.user
        localStorage.setItem('token', this.token)
        return { success: true }
      } catch (error) {
        return { success: false, message: error.response.data.message }
      }
    },
    
    async register(userData) {
      try {
        const response = await axios.post('/api/auth/register', userData)
        return { success: true, message: response.data.message }
      } catch (error) {
        return { success: false, message: error.response.data.message }
      }
    },
    
    logout() {
      this.user = null
      this.token = null
      localStorage.removeItem('token')
    }
  }
})
```

#### 4.3 配置Element Plus

```javascript
// frontend/src/main.js
import { createApp } from 'vue'
import App from './App.vue'
import router from './router'
import { createPinia } from 'pinia'
import ElementPlus from 'element-plus'
import 'element-plus/dist/index.css'

const app = createApp(App)
app.use(createPinia())
app.use(router)
app.use(ElementPlus)
app.mount('#app')
```

### Day 5-7: 基础页面开发

#### 5.1 主布局组件

```vue
<!-- frontend/src/App.vue -->
<template>
  <div id="app">
    <el-container>
      <el-header>
        <div class="header-content">
          <h1>FiveM服务器官网</h1>
          <div class="nav-buttons">
            <el-button v-if="!authStore.user" @click="$router.push('/login')">登录</el-button>
            <el-button v-if="!authStore.user" @click="$router.push('/register')">注册</el-button>
            <el-dropdown v-if="authStore.user">
              <span>{{ authStore.user.username }}</span>
              <template #dropdown>
                <el-dropdown-menu>
                  <el-dropdown-item v-if="authStore.user.role === 'admin'" @click="$router.push('/admin')">管理后台</el-dropdown-item>
                  <el-dropdown-item @click="logout">退出登录</el-dropdown-item>
                </el-dropdown-menu>
              </template>
            </el-dropdown>
          </div>
        </div>
      </el-header>
      <el-main>
        <router-view />
      </el-main>
    </el-container>
  </div>
</template>

<script setup>
import { useAuthStore } from './stores/auth'

const authStore = useAuthStore()

const logout = () => {
  authStore.logout()
  router.push('/')
}
</script>
```

#### 5.2 首页组件

```vue
<!-- frontend/src/views/Home.vue -->
<template>
  <div class="home">
    <el-row :gutter="20">
      <el-col :span="12">
        <el-card>
          <template #header>
            <span>服务器状态</span>
          </template>
          <div v-if="serverStatus">
            <p>在线人数: {{ serverStatus.players }}</p>
            <p>服务器状态: {{ serverStatus.status }}</p>
          </div>
          <div v-else>
            <p>正在获取服务器状态...</p>
          </div>
        </el-card>
      </el-col>
      <el-col :span="12">
        <el-card>
          <template #header>
            <span>最新公告</span>
          </template>
          <div v-for="announcement in announcements" :key="announcement.id">
            <h4>{{ announcement.title }}</h4>
            <p>{{ announcement.content }}</p>
          </div>
        </el-card>
      </el-col>
    </el-row>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue'
import axios from 'axios'

const serverStatus = ref(null)
const announcements = ref([])

onMounted(async () => {
  // 获取服务器状态
  try {
    const response = await axios.get('/api/server/status')
    serverStatus.value = response.data
  } catch (error) {
    console.error('获取服务器状态失败:', error)
  }
  
  // 获取最新公告
  try {
    const response = await axios.get('/api/contents?type=announcement&limit=3')
    announcements.value = response.data
  } catch (error) {
    console.error('获取公告失败:', error)
  }
})
</script>
```

## 第2周开发流程

### Day 8-10: 服务器状态功能

#### 8.1 后端服务器状态API

```javascript
// backend/routes/server.js
const express = require('express');
const axios = require('axios');
const router = express.Router();

// 获取FiveM服务器状态
router.get('/status', async (req, res) => {
    try {
        const fivemServer = process.env.FIVEM_SERVER || 'localhost:30120';
        const response = await axios.get(`http://${fivemServer}/info.json`, {
            timeout: 5000
        });
        
        res.json({
            status: 'online',
            players: response.data.clients || 0,
            maxPlayers: response.data.sv_maxclients || 32,
            serverName: response.data.hostname || 'FiveM Server'
        });
    } catch (error) {
        res.json({
            status: 'offline',
            players: 0,
            maxPlayers: 32,
            serverName: 'FiveM Server'
        });
    }
});

module.exports = router;
```

#### 8.2 前端服务器状态组件

```vue
<!-- frontend/src/components/ServerStatus.vue -->
<template>
  <el-card class="server-status">
    <template #header>
      <div class="card-header">
        <span>服务器状态</span>
        <el-button size="small" @click="refreshStatus">刷新</el-button>
      </div>
    </template>
    
    <div class="status-content">
      <div class="status-item">
        <span class="label">服务器名称:</span>
        <span class="value">{{ status.serverName }}</span>
      </div>
      <div class="status-item">
        <span class="label">在线人数:</span>
        <span class="value">{{ status.players }}/{{ status.maxPlayers }}</span>
      </div>
      <div class="status-item">
        <span class="label">状态:</span>
        <el-tag :type="status.status === 'online' ? 'success' : 'danger'">
          {{ status.status === 'online' ? '在线' : '离线' }}
        </el-tag>
      </div>
    </div>
  </el-card>
</template>

<script setup>
import { ref, onMounted } from 'vue'
import axios from 'axios'

const status = ref({
  serverName: 'FiveM Server',
  players: 0,
  maxPlayers: 32,
  status: 'offline'
})

const fetchStatus = async () => {
  try {
    const response = await axios.get('/api/server/status')
    status.value = response.data
  } catch (error) {
    console.error('获取服务器状态失败:', error)
  }
}

const refreshStatus = () => {
  fetchStatus()
}

onMounted(() => {
  fetchStatus()
  // 每5分钟自动刷新
  setInterval(fetchStatus, 5 * 60 * 1000)
})
</script>
```

### Day 11-14: 内容管理系统

#### 11.1 后端内容管理API

```javascript
// backend/routes/contents.js
const express = require('express');
const db = require('../config/database');
const auth = require('../middleware/auth');
const router = express.Router();

// 获取内容列表
router.get('/', async (req, res) => {
    try {
        const { type, limit = 10, offset = 0 } = req.query;
        let query = 'SELECT c.*, u.username as author_name FROM contents c JOIN users u ON c.author_id = u.id';
        let params = [];
        
        if (type) {
            query += ' WHERE c.type = ?';
            params.push(type);
        }
        
        query += ' ORDER BY c.created_at DESC LIMIT ? OFFSET ?';
        params.push(parseInt(limit), parseInt(offset));
        
        const [rows] = await db.promise().execute(query, params);
        res.json(rows);
    } catch (error) {
        res.status(500).json({ success: false, message: '获取内容失败' });
    }
});

// 创建内容（需要管理员权限）
router.post('/', auth, async (req, res) => {
    if (req.user.role !== 'admin') {
        return res.status(403).json({ success: false, message: '权限不足' });
    }
    
    try {
        const { title, content, type } = req.body;
        const result = await db.promise().execute(
            'INSERT INTO contents (title, content, type, author_id) VALUES (?, ?, ?, ?)',
            [title, content, type, req.user.userId]
        );
        res.json({ success: true, message: '内容创建成功' });
    } catch (error) {
        res.status(500).json({ success: false, message: '创建内容失败' });
    }
});

module.exports = router;
```

#### 11.2 管理员后台页面

```vue
<!-- frontend/src/views/Admin.vue -->
<template>
  <div class="admin">
    <el-tabs v-model="activeTab">
      <el-tab-pane label="内容管理" name="content">
        <div class="content-management">
          <el-button type="primary" @click="showCreateDialog = true">创建内容</el-button>
          
          <el-table :data="contents" style="width: 100%; margin-top: 20px;">
            <el-table-column prop="title" label="标题" />
            <el-table-column prop="type" label="类型" />
            <el-table-column prop="author_name" label="作者" />
            <el-table-column prop="created_at" label="创建时间" />
            <el-table-column label="操作">
              <template #default="scope">
                <el-button size="small" @click="editContent(scope.row)">编辑</el-button>
                <el-button size="small" type="danger" @click="deleteContent(scope.row.id)">删除</el-button>
              </template>
            </el-table-column>
          </el-table>
        </div>
      </el-tab-pane>
    </el-tabs>
    
    <!-- 创建内容对话框 -->
    <el-dialog v-model="showCreateDialog" title="创建内容" width="60%">
      <el-form :model="newContent" label-width="80px">
        <el-form-item label="标题">
          <el-input v-model="newContent.title" />
        </el-form-item>
        <el-form-item label="类型">
          <el-select v-model="newContent.type">
            <el-option label="公告" value="announcement" />
            <el-option label="指南" value="guide" />
          </el-select>
        </el-form-item>
        <el-form-item label="内容">
          <el-input v-model="newContent.content" type="textarea" :rows="10" />
        </el-form-item>
      </el-form>
      <template #footer>
        <el-button @click="showCreateDialog = false">取消</el-button>
        <el-button type="primary" @click="createContent">创建</el-button>
      </template>
    </el-dialog>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue'
import axios from 'axios'
import { ElMessage } from 'element-plus'

const activeTab = ref('content')
const showCreateDialog = ref(false)
const contents = ref([])
const newContent = ref({
  title: '',
  content: '',
  type: 'announcement'
})

const fetchContents = async () => {
  try {
    const response = await axios.get('/api/contents')
    contents.value = response.data
  } catch (error) {
    ElMessage.error('获取内容列表失败')
  }
}

const createContent = async () => {
  try {
    await axios.post('/api/contents', newContent.value)
    ElMessage.success('内容创建成功')
    showCreateDialog.value = false
    newContent.value = { title: '', content: '', type: 'announcement' }
    fetchContents()
  } catch (error) {
    ElMessage.error('创建内容失败')
  }
}

onMounted(() => {
  fetchContents()
})
</script>
```

## 部署流程

### 1. 环境配置

```bash
# 创建.env文件
# backend/.env
DB_HOST=localhost
DB_USER=root
DB_PASSWORD=your_password
DB_NAME=fivem_website
JWT_SECRET=your_jwt_secret
FIVEM_SERVER=your_fivem_server:30120
PORT=3000
```

### 2. 构建前端

```bash
cd frontend
npm run build
```

### 3. 启动后端

```bash
cd backend
npm start
```

### 4. Nginx配置

```nginx
server {
    listen 80;
    server_name your_domain.com;
    
    location / {
        root /path/to/frontend/dist;
        try_files $uri $uri/ /index.html;
    }
    
    location /api {
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

## 开发注意事项

1. **代码规范**: 使用ESLint和Prettier保持代码风格一致
2. **错误处理**: 所有API调用都要有错误处理
3. **安全性**: 密码加密、JWT验证、SQL注入防护
4. **性能优化**: 数据库索引、前端懒加载
5. **测试**: 关键功能要有单元测试

## 常见问题解决

1. **跨域问题**: 配置CORS中间件
2. **数据库连接失败**: 检查MySQL服务状态和配置
3. **JWT验证失败**: 检查密钥配置和token格式
4. **前端路由问题**: 配置history模式和后端重定向

这个开发流程文档提供了完整的开发指导，按照这个流程可以在2周内完成基础版本的开发。
